@page
@model AddBankModel
@{
    ViewData["Title"] = "Add foodbank";
}

<link rel="stylesheet" href="/css/Control.Geocoder.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css"/>


<script src="https://unpkg.com/leaflet@latest/dist/leaflet-src.js"></script>
<script src="/js/Control.Geocoder.js"></script>



<div class="text-center">
    <h1 class="display-4">Foodbank Submission form</h1>
</div>

<div class="container">
    <div class="d-grid col-7 mx-auto">
        <p class="h6 text-box">
            We are glad that you have decided to register your foodbank with us please fill up the required fields
            and press the submit button. Please bear in mind that "Foodbank finder" reserves the right to accept or reject your submission. You
            will recieve an email with our decision soon after you submitted. NOTE: the fields with a star are mandatory
        </p>
    </div>
</div>

<form method="post">
    <div asp-validation-summary="All"></div>
    <div class="container">
        <div class="row">
            <div class="col-6 d-grid mx-auto">
                <div class="mb-3">
                    <label for="fbName" class="form-label">Enter the name of your foodbank/charity *</label>
                    <input asp-for="foodbank.Name" type="text" class="form-control" id="fbName" placeholder="ex: West Cheshire Foodbank"/>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Contact Email *</label>
                    <input asp-for="foodbank.Email" type="email" class="form-control" id="fbEmail" placeholder="ex: brelan@yahoo.co.uk" aria-describedby="emInst"/>
                    <div id="emInst" class="form-text">This will be the E-mail we'll use to comunicate with you</div>
                </div>
                <div class="mb-3">
                    <label for="charNo" class="form-label">Charity No (if applicable)</label>
                    <input asp-for="foodbank.CharityNumber" type="text" class="form-control" id="charno" placeholder="ex: 1234567" aria-describedby="measure"/>
                    <div id="measure" class="form-text">If you are not a registered charity you may need to provide proof of identity</div>
                </div>
                <div class="mb-3">
                    <label for="urlChar" class="form-label"> Charity Regiser URL</label>
                    <input asp-for="foodbank.CharityRegisterUrl" type="url" class="form-control" id="regurl" aria-describedby="urlwhat" />
                    <div id="urlwhat" class="form-text">The link to your charity page on the national register</div>
                </div>
                <div class="mb-3">
                    <label for="pho" class="form-label">Phone number</label>
                    <input asp-for="foodbank.Phone" type="text" class="form-control" id="pho" placeholder="ex 123456789877" aria-describedby="phor"/>
                    <div id="phor" class="form-text">This will be your contact phone for general enquiries from the public</div>
                </div>
            </div>
            <div class="col-6 d-grid mx-auto">
                <div class="mb-3">
                    <label for="postcode" class="form-label">Type your post code in the search box below</label>
                    <div id="map" style="height: 20vw;
                                        width: 40vw;
                                        margin: auto;
                                        margin-top: 2%;"></div>
                    
                    <div class="mb-3 d-grid">
                        <input id="map-address" asp-for="foodbank.Address" value="" readonly placeholder="Address" />
                    </div>
                    <div class="mb-3 invisible">
                        <input id="map-lat" asp-for="lat" value="" readonly placeholder="Latitude" />
                        <input id="map-lng" asp-for="lng" value="" readonly placeholder="Longitude" />
                        <input id="map-postcode" asp-for="foodbank.Postcode" value="" placeholder="Postcode" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-6 d-grid">
                
                <div class="mb-3">
                    <label for="url" class="form-label">Website URL</label>
                    <input asp-for="foodbank.Homepage" type="url" class="form-control" id="website" placeholder="ex: https://www.salvationarmy.org.uk"/>
                </div>
                <div class="mb-3">
                    <label for="shop" class="form-label">Shoppinglist link</label>
                    <input asp-for="foodbank.ShoppingList" type="url" class="form-control" id="shopNeed" aria-describedby="shoplink" />
                    <div id="shoplink" class="form-text">If you have google shopping list you can send a link to show people your foodbank's needs</div>
                </div>
            </div>
            <div class="col-6 d-grid">
                <div class="col-10">
                    <h4> </h4>
                </div>
                <div class="col-4">
                    <select asp-for="foodbank.Country"class="form-select" aria-label="Country">
                        <option selected>Country</option>
                        <option value="England">England</option>
                        <option value="Scotland">Scotland</option>
                        <option value="Wales">Wales</option>
                        <option value="Northern Ireland">N. Ireland</option>
                        <option value="Guernsey">Guernsey</option>
                        <option value="Jersey">Jersey</option>
                        <option value="Isle of Man">Isle of Man</option>
                    </select>
                </div>
                <div class="col-4">
                    <select asp-for="foodbank.Network" class="form-select" aria-label="Network or association">
                        <option selected>Select the network you are associated with</option>
                        <option value="Trussel Trust">Trussel Trust</option>
                        <option value="IFAN">IFAN</option>
                        <option value="Independent">Independent</option>
                    </select>
                </div>
            </div>
        </div>
        @* <!--<div class="row mt-2"> *@
        @*     <div class="d-grid col-6 mx-auto"> *@
        @*         <label for="needs" class="form-label">Main or urgent needs for your foodbank</label> *@
        @*         <input asp-for="needs" type="text" class="form-control" id="ne1" placeholder="Item 1" /> *@
        @*         <input asp-for="needs" type="text" class="form-control" id="ne2" placeholder="Item 2" /> *@
        @*         <input asp-for="needs" type="text" class="form-control" id="ne3" placeholder="Item 3" /> *@
        @*         <input asp-for="needs" type="text" class="form-control" id="ne4" placeholder="Item 4" /> *@
        @*         <input asp-for="needs" type="text" class="form-control" id="ne5" placeholder="Item 5" /> *@
        @*         <input asp-for="needs" type="text" class="form-control" id="ne6" placeholder="Item 6" /> *@
        @*     </div> *@
        @* </div>--> *@
        <div class="row mt-3">
            <div class="col-9 d-grid mx-auto">
                <div class="mb-3 form-check">
                    <input asp-for="consent" type="checkbox" class="form-check-input" required id="consent" onchange="this.setCustomValidity(validity.valueMissing ? 'Please indicate that you accept the terms and conditions' : '');"/>
                    <label class="form-check label" for="consent"><strong>I consent to let foodbank finder collect and display the provided information</strong></label>
                </div>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-9 d-grid mx-auto">
                <div class="mb-3 form-check">
                    <input asp-for="confirm" type="checkbox" class="form-check-input" required id="confirm" onchange="this.setCustomValidity(validity.valueMissing ? 'Please indicate that you vouch for the validity of the info' : '');" />
                    <label class="form-check label" for="confirm"><strong>
                        I confirm that the provided information is true to the extent of my knowledge</strong>
                    </label>
                </div>
            </div>
        </div>
        <div class="row gx-5">
            <div class="col-9 d-grid mx-auto">
                <input type="submit" class="btn btn-outline-success">
            </div>
        </div>
    </div>




<script type="text/javascript">

        var map = L.map('map').setView([ 54.596442,  -3.9], 6);

        var geocoder = L.Control.Geocoder.nominatim({
             geocodingQueryParams: {countrycodes: 'gb,im,gg,je'}
        });
        if (typeof URLSearchParams !== 'undefined' && location.search) {
          var params = new URLSearchParams(location.search);
          var geocoderString = params.get('geocoder');
          if (geocoderString && L.Control.Geocoder[geocoderString]) {
            console.log('Using geocoder', geocoderString);
            geocoder = L.Control.Geocoder[geocoderString]();
          } else if (geocoderString) {
            console.warn('Unsupported geocoder', geocoderString);
          }
        }
        var ml;

        var control = L.Control.geocoder({
            collapsed: false,
            placeholder: 'Search Postcode or Address',
            geocoder
        })

        .on('markgeocode', function(e) {
          var usersLatitude = e.geocode.center.lat;
          var usersLongitude = e.geocode.center.lng;
          ml = e;
          console.log(e)
          var addressString = "";
          $("#map-lat").val(usersLatitude);
          $("#map-lng").val(usersLongitude);
          $("#map-postcode").val(e.geocode.properties.address.postcode);
          if (e.geocode.properties.address.house_number != undefined)    { addressString = addressString.concat(e.geocode.properties.address.house_number + ",")}
          if (e.geocode.properties.address.road != undefined)            { addressString = addressString.concat(e.geocode.properties.address.road + ",")}
          if (e.geocode.properties.address.neighbourhood != undefined)   { addressString = addressString.concat(e.geocode.properties.address.neighbourhood + ",")}
          if (e.geocode.properties.address.town != undefined)            { addressString = addressString.concat(e.geocode.properties.address.town + ",")}
          if (e.geocode.properties.address.suburb != undefined)          { addressString = addressString.concat(e.geocode.properties.address.suburb + ",")}
          if (e.geocode.properties.address.city != undefined)            { addressString = addressString.concat(e.geocode.properties.address.city + ",")}
          if (e.geocode.properties.address.country != undefined)         { addressString = addressString.concat(e.geocode.properties.address.country  + ",")}
          if (e.geocode.properties.address.state != undefined)           { addressString = addressString.concat(e.geocode.properties.address.state)}

          

          console.log(addressString)
          $("#map-address").val(addressString);
        })
        .addTo(map);

        control._expand();

        L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

    </script>
</form>


<script>
    document.getElementById("consent").setCustomValidity("Please indicate that you accept the terms and conditions");
    document.getElementById("confirm").setCustomValidity("Please indicate that you vouch for the validity of the info");
</script>