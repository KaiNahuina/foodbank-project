@page "{id:int}"
@model MainLocationModel
@{
    ViewData["Title"] = "Main Location";
}
<link rel="stylesheet" href="/css/Control.Geocoder.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css"/>


<script src="https://unpkg.com/leaflet@latest/dist/leaflet-src.js"></script>
<script src="/js/Control.Geocoder.js"></script>

<div class="text-center ">
    <p>
        Disclaimer: Vouchers may be required to access the bank. <a asp-page="/GetHelp/Vouchers">Learn more here.</a>
    </p>
</div>

<form method="post">
    <div class="text-center">
        <h1 class="display-4"><b>Main Location Name: </b>@Html.DisplayFor(modelItem => modelItem.Foodbank!.Name)</h1>
    </div>

    <div class="row">
        <div class="container mt-2">
            <div class="row">
                <div class="col-sm-4">
                    <h3>Address</h3>
                    <p class="text-box">
                        <b>Address: </b>@Html.DisplayFor(modelItem => modelItem.Foodbank!.Address) <br/>
                        <b>Postcode: </b>@Html.DisplayFor(modelItem => modelItem.Foodbank!.Postcode) <br/>
                        <b>Country: </b>@Html.DisplayFor(modelItem => modelItem.Foodbank!.Country) <br/>
                    </p>
                </div>
                <div class="col-sm-4">
                    <h3>Contact Infomation</h3>
                    <p class="text-box">
                        <b>Email Address: </b> @Html.DisplayFor(modelItem => modelItem.Foodbank!.Email) <br/>
                        <b>Website site/Facebook: </b> @Html.DisplayFor(modelItem => modelItem.Foodbank!.Homepage) <br/>
                        <b>Phone Number: </b> @Html.DisplayFor(modelItem => modelItem.Foodbank!.Phone) <br/>
                        <b>Network: </b> @Html.DisplayFor(modelItem => modelItem.Foodbank!.Network)
                    </p>
                </div>
                <div class="col-sm-2">
                    @if (Model.Foodbank!.Network == "Trussell Trust")
                    {
                        <img id="trusselTrust" src="/img/TT-Logo.jpg" style="width: 70%;height: 70%" alt=""/>
                    }
                    @if (Model.Foodbank.Network == "IFAN")
                    {
                        <img id="IFAN" src="/img/IFAN-Logo.jpg" style="width: 70%;height: 70%" alt=""/>
                    }
                    @if (Model.Foodbank.Network == "Independent")
                    {
                        <img id="Independent" src="/img/Independent-logo.jpg" style="width: 70%;height: 70%" alt=""/>
                    }

                    <h3></h3>
                </div>
            </div>
        </div>
    </div>


    <div class="container">
        <div class="row">
            <div class="col-sm-12 mx-auto">
                <h3><a href='https://www.youtube.com/watch?v=dQw4w9WgXcQ&ab_channel=RickAstley'>Click here for directions</a></h3> <!-- link that sends them to google with their lat and long as a search function-->
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-11 d-grid mx-auto">
                <div class="image-box" id="map"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-10 d-grid mx-auto">
                <h1>Foodbank Needs</h1>
                <p class="text-box">
                    @if (Model.Foodbank.Needs?.Count == 0 || Model.Foodbank.Needs!.All(n => n.NeedStr is null))
                    {
                        @Html.Raw("This foodbank has no needs") <br />
                    }
                    else
                    {
                        @foreach (var need in Model.Foodbank.Needs!)
                        {
                            @Html.DisplayFor(modelItem => need.NeedStr) <br />
                        }
                    }
                </p>
            </div>
        </div>
    </div>

    <!-- If its a salvation army then don't do this-->
    <div class="text-center">
        <h1 class="display-4">Associated Foodbanks</h1>
    </div>
    <table class="table table-striped table-hover w-100">
        <thead>
        <tr>
            <th scope="col">Name</th>
            <th scope="col">Address</th>
            <th scope="col">Foodbank</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var item in Model.Foodbank.Locations!)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Address)
                </td>
                <td>
                    <a asp-page="/Foodbank/Index" asp-route-id="@item.LocationId">View foodbank</a>
                </td>
            </tr>
        }
        </tbody>
    </table>


    <script type="text/javascript">

        var foodbankIcon = L.icon({
              iconUrl: '/img/leaf.png',
              iconSize:     [30, 30],
              iconAnchor:   [0, 30],
              popupAnchor:  [15, -30]
        });

        var warehouseIcon = L.icon({
              iconUrl: '/img/warehouse.png',//copy righted dont use for final
              iconSize:     [50, 50],
              iconAnchor:   [25, 50],
              popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });

        var map = L.map('map').setView([ 54.596442,  -3.9], 6);

        var locationMarker = L.marker([@Html.Raw(Model.Foodbank.Coord!.Y),@Html.Raw(Model.Foodbank.Coord.X)], {icon:warehouseIcon}).bindPopup("<a href='https://www.youtube.com/watch?v=dQw4w9WgXcQ&ab_channel=RickAstley'>Click here for directions</a>").addTo(map);

        map.setView([@Html.Raw(Model.Foodbank.Coord.Y),@Html.Raw(Model.Foodbank.Coord.X)], 15);

        var geocoder = L.Control.Geocoder.nominatim({
             geocodingQueryParams: {countrycodes: 'gb,im,gg,je'}
        });
        if (typeof URLSearchParams !== 'undefined' && location.search) {
          var params = new URLSearchParams(location.search);
          var geocoderString = params.get('geocoder');
          if (geocoderString && L.Control.Geocoder[geocoderString]) {
            console.log('Using geocoder', geocoderString);
            geocoder = L.Control.Geocoder[geocoderString]();
          } else if (geocoderString) {
            console.warn('Unsupported geocoder', geocoderString);
          }
        }

        L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

    </script>
</form>